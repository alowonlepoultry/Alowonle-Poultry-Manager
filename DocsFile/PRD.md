Alowwonle Poultry Manager

This document focuses on **logic, state management, and calculations** so the developers know exactly how data flows from Input to Result.

***

# Project: Poultry Manager MVP (Version 1.0)
**Platform:** Flutter (Android focus for V1)
**Architecture:** Offline-First (Local Database - e.g., Hive, SQLite, or Drift)
**Goal:** Google Play Approval + High Utility for Farmers.

Tech stack: Riverpod for state, Hive for local database, GoRouter for navigation, and FL_Chart for graphs.

---

## 1. Data Structure & Relationships
*Before building UI, the developer must set up these local database tables:*
1.  **Pen/Flock:** ID, Name, Breed, Initial Bird Count, Date Started.
2.  **Inventory:** Feed Type, Current Balance (kg), Low Stock Threshold (kg).
3.  **Daily Log:** Date, PenID, Mortality Count, Feed Consumed (kg), Eggs Collected.

---

## 2. Feature Logic & Specifications

### A. Dashboard (Home Screen)
**State:**
*   If `List<Pens>` is empty → Show **Empty State** ("No Pens active. Tap '+' to start.").
*   If `List<Pens>` exists → Show Dashboard Widgets.

**Widgets & Logic:**
1.  **Feed Alert Card:**
    *   *Logic:* Query `Inventory Table`. If `Current Balance` < `Threshold`, show RED warning banner: "Low Feed Warning: [X]kg remaining."
2.  **Production Trend (Chart):**
    *   *Logic:* Query `Daily Logs` for the last 7 days. Sum `Eggs Collected` per day.
    *   *Display:* Simple Line Chart (X-axis: Date, Y-axis: Egg Count).
3.  **Quick Stats:**
    *   **Total Birds Alive:** `Sum(Initial Birds)` - `Sum(All Mortality Logs)`.
    *   **Today’s Eggs:** `Sum(Eggs Collected)` where `Date == Today`.

---

### B. Pen Management (Create & View)
**Feature:** Create a new Pen.
*   **Inputs:**
    *   Pen Name (String)
    *   Breed (String)
    *   Initial Bird Count (Integer)
*   **Action:** Save to Database.

**Feature:** Pen Detail View (The "Performance Card").
*   **Display:**
    *   **Current Flock Size:** `Initial Count` - `Total Mortality for this Pen`.
    *   **Mortality Rate:** `(Total Mortality / Initial Count) * 100`.
        *   *UI Logic:* If > 5%, text color Red (High); if < 5%, text color Green (Good).

---

### C. Daily Logging (The Core Logic)
*The developer must ensure this screen updates two different database tables simultaneously.*

**Inputs:**
1.  **Select Pen** (Dropdown).
2.  **Select Feed Type** (Dropdown - from Inventory).
3.  **Mortality** (Integer, Default 0).
4.  **Feed Given** (Decimal/Double in kg).
5.  **Eggs Collected** (Integer).
6.  **Date** (Date Picker, Default = Today).

**Logic & Calculations (On Save):**
1.  **Save Log:** Create entry in `Daily Log` table.
2.  **Update Inventory (Crucial):**
    *   Fetch `Current Feed Balance`.
    *   Calculate: `New Balance` = `Current Balance` - `Feed Given Input`.
    *   *Validation:* If `Feed Given` > `Current Balance`, show Warning Dialog: "Not enough feed in inventory. Proceed anyway?"

---

### D. Inventory Management
**Feature:** Add Stock.
*   **Inputs:**
    *   Added Quantity (kg).
    *   Price per unit (Optional - for V2, keep hidden for now if simplest MVP).
*   **Logic:** `Current Balance` = `Current Balance` + `Added Quantity`.

**Feature:** Set Threshold.
*   **Input:** Minimum kg (e.g., 50kg).
*   **Logic:** Used solely for the Dashboard "Low Stock" banner trigger.

---

### E. Tools & Reports

#### 1. FCR Calculator (Standalone Tool)
*This does not pull from the DB automatically in V1 to avoid complexity. It is a manual calculator.*
*   **Inputs:**
    *   Total Feed Consumed (kg).
    *   Total Weight Gained / Total Bird Weight (kg).
*   **Formula:**
    $$FCR = \frac{\text{Total Feed Consumed}}{\text{Total Weight Produced}}$$
*   **Result:** Display value (e.g., 1.5).
    *   *Context Text:* "Lower is better. Standard is 1.5 - 1.7 for Broilers."

#### 2. Weekly Report (PDF Export)
*   **Input:** Select Date Range (Default: Last 7 Days).
*   **Process:**
    1.  Query `Daily Logs` within range.
    2.  Calculate Totals: Total Eggs, Total Mortality, Total Feed.
*   **Output:** Generate PDF using a Flutter PDF package.
*   **Content:**
    > **Weekly Farm Report**
    > Date: 12/01/2024 - 19/01/2024
    > ----------------------------
    > Total Eggs: 450
    > Feed Used: 120kg
    > Mortality: 3 Birds
    > ----------------------------
    > *Generated by [App Name]*

---

## 3. Developer Constraints & Requirements

1.  **Offline Handling:**
    *   Use `Hive` or `Sqflite`.
    *   App must never show a loading spinner for more than 200ms.
    *   Data persists when the app is closed.

2.  **Empty States (Google Approval Requirement):**
    *   Every list view (Logs, Inventory, Pens) must have a widget that shows when data is empty.
    *   *Text:* "No records found. Add your first record."

3.  **Input Validation:**
    *   Mortality cannot be negative.
    *   Feed Given cannot be negative.
    *   If Mortality > Current Bird Count → Show Error "You cannot record more dead birds than alive birds."

4.  **Test Mode:**
    *   Pre-fill the database with "Demo Data" button in settings (optional but helps testing).
    *   **OR** Hardcode a "Demo User" logic if you implement a login screen (though V1 works best as local-only/no-login).



5.  **Tech stack**

   dependencies:
  flutter:
    sdk: flutter
  
  # State Management
  flutter_riverpod: ^3.0.3
  riverpod_annotation: ^2.6.2

  # Local Database
  hive_ce: ^2.15.1
  hive_ce_flutter: ^2.0.1
  path_provider: ^2.1.5

  # Navigation
  go_router: ^17.0.0

  # Charts
  fl_chart: ^1.1.1

dev_dependencies:
  flutter_test:
    sdk: flutter
  
  # Code Generation
  riverpod_generator: ^2.6.2
  build_runner: ^2.4.13
  hive_ce_generator: ^1.6.0
  
  # Linting
  flutter_lints: ^6.0.0
  riverpod_lint: ^2.6.2  # Optional but recommended for Riverpod best practices
---

### Summary for Developer
**"How the app works":**
The user creates a **Pen**. Every day, they open **Daily Logs** and record what happened. When they record **Feed Use**, the app automatically subtracts that amount from the **Inventory** balance. The **Dashboard** visualizes this data so the farmer knows if they are running out of food or if egg production is dropping. The app must work 100% without internet.